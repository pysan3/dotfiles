/* Source file https://github.com/MrOtherGuy/firefox-csshacks/tree/master/chrome/navbar_tabs_oneliner_tabs_on_left.css made available under Mozilla Public License v. 2.0
See the above repository for updates as well as full license text. */

/*Make tabs and navbar appear side-by-side tabs on left */

/* IMPORTANT */
/*
Get window_control_placeholder_support.css
Window controls will be all wrong without it
*/

/* Modify these to change relative widths or default height */
:root {
  --uc-navigationbar-width: 55vw;
  --uc-toolbar-height: 32px;
  --uc-urlbar-min-width: 50vw; /* minimum width for opened urlbar */
  --tab-block-margin: 0px !important;
}

:root[uidensity="compact"] {
  --tab-block-margin: 2px !important;
}

#scrollbutton-up,
#scrollbutton-down {
  border-block-width: 2px !important;
}

/* Override for other densities */
:root[uidensity="compact"] {
  --uc-toolbar-height: 30px;
}
:root[uidensity="touch"] {
  --uc-toolbar-height: 44px;
}

:root[uidensity="compact"] #urlbar-container {
  padding-block: 0 !important;
}
:root #urlbar-container {
  --urlbar-container-height: var(--uc-toolbar-height) !important;
}
:root #urlbar {
  --urlbar-toolbar-height: var(--uc-toolbar-height) !important;
}

:root {
  --tab-min-height: calc(
    var(--uc-toolbar-height) - 2 * var(--tab-block-margin, 0px)
  ) !important;
}

/* prevent urlbar overflow on narrow windows */
/* Dependent on how many items are in navigation toolbar and tabs-/nav-bar ratio - ADJUST AS NEEDED */
@media screen and (max-width: 1600px) {
  #urlbar-container {
    min-width: unset !important;
  }
}

:root[tabsintitlebar] #toolbar-menubar {
  height: initial !important;
}
:root[tabsintitlebar]
  #toolbar-menubar[inactive]
  > :not(.titlebar-buttonbox-container) {
  opacity: 0;
  pointer-events: none;
}
:root[tabsintitlebar] #toolbar-menubar[inactive] {
  margin-bottom: calc(0px - var(--uc-toolbar-height));
}

#TabsToolbar > .titlebar-buttonbox-container,
.titlebar-spacer[type="post-tabs"] {
  display: none;
}
#TabsToolbar {
  margin-right: var(--uc-navigationbar-width);
  --tabs-navbar-shadow-size: 0px;
  height: var(--tab-min-height) !important;
}

#tabbrowser-tabs {
  --tab-min-height: calc(
    var(--uc-toolbar-height) - 2 * var(--tab-block-margin, 0px)
  ) !important;
}

#toolbar-menubar[autohide="true"] > .titlebar-buttonbox-container {
  min-height: var(--uc-toolbar-height) !important;
}
#tabbrowser-tabs,
.tabbrowser-tab[pinned] {
  min-height: var(--tab-min-height) !important;
}
#nav-bar {
  margin-left: calc(100vw - var(--uc-navigationbar-width));
  margin-top: calc(0px - var(--uc-toolbar-height));
}

/* Override style set in window_control_placeholder_support.css  */
#nav-bar {
  border-left-width: 0px !important;
}
#nav-bar::before {
  display: none !important;
}

/* Rules specific to window controls on right layout */
@supports -moz-bool-pref("layout.css.osx-font-smoothing.enabled") {
  :root:not([inFullscreen])
    #TabsToolbar-customization-target
    > .titlebar-spacer[type="pre-tabs"] {
    width: var(--uc-window-drag-space-post) !important;
    display: -moz-box !important;
  }
  #TabsToolbar > .titlebar-buttonbox-container {
    display: -moz-box;
  }
}

/* 1px margin on touch density causes tabs to be too high */
.tab-close-button {
  margin-top: 0 !important;
}

/* Make opened urlbar overlay the toolbar */
#urlbar[open]:focus-within {
  min-width: var(--uc-urlbar-min-width, none) !important;
  right: 0 !important;
  left: auto !important;
}

/* Hide dropdown placeholder */
/* #urlbar-container:not(:hover) .urlbar-history-dropmarker { */
/*   margin-inline-start: -28px; */
/* } */

/* Fix customization view */
#customization-panelWrapper > .panel-arrowbox > .panel-arrow {
  margin-inline-end: initial !important;
}

/* Source file https://github.com/MrOtherGuy/firefox-csshacks/tree/master/chrome/window_control_placeholder_support.css made available under Mozilla Public License v. 2.0
See the above repository for updates as well as full license text. */

/* Creates placeholders for window controls */
/* This is a supporting file used by other stylesheets */

/* This stylesheet is pretty much unnecessary if window titlebar is enabled */

/* This file should preferably be imported before other stylesheets */

/* Defaults for window controls on RIGHT side of the window */
/* Modify these values to match your preferences */
:root:is([tabsintitlebar], [sizemode="fullscreen"]) {
  --uc-window-control-width: 138px; /* Space reserved for window controls (Win10) */
  /* Extra space reserved on both sides of the nav-bar to be able to drag the window */
  --uc-window-drag-space-pre: 30px; /* left side*/
  --uc-window-drag-space-post: 30px; /* right side*/
}

:root:is([tabsintitlebar][sizemode="maximized"], [sizemode="fullscreen"]) {
  --uc-window-drag-space-pre: 0px; /* Remove pre space */
}

@media (-moz-platform: windows-win7),
  (-moz-platform: windows-win8),
  (-moz-os-version: windows-win7),
  (-moz-os-version: windows-win8) {
  :root:is([tabsintitlebar], [sizemode="fullscreen"]) {
    --uc-window-control-width: 105px;
  }
}

@media (-moz-gtk-csd-available) {
  :root:is([tabsintitlebar], [sizemode="fullscreen"]) {
    --uc-window-control-width: 84px;
  }
}

/* macOS settings are further below */
.titlebar-buttonbox,
#window-controls {
  color: var(--toolbar-color);
}
:root[sizemode="fullscreen"] .titlebar-buttonbox-container {
  display: none;
}
:root[sizemode="fullscreen"] #navigator-toolbox {
  position: relative;
}

:root[sizemode="fullscreen"]
  #TabsToolbar
  > .titlebar-buttonbox-container:last-child,
:root[sizemode="fullscreen"] #window-controls {
  position: absolute;
  display: flex;
  top: 0;
  right: 0;
  height: 20px;
}

:root[sizemode="fullscreen"]
  #TabsToolbar
  > .titlebar-buttonbox-container:last-child,
:root[uidensity="compact"][sizemode="fullscreen"] #window-controls {
  height: 20px;
}

#nav-bar {
  border-inline: var(--uc-window-drag-space-pre, 0px) solid
    var(--toolbar-bgcolor);
  border-inline-style: solid !important;
  border-right-width: calc(
    var(--uc-window-control-width, 0px) + var(--uc-window-drag-space-post, 0px)
  );
}

/* Use this pref to check Mac OS where window controls are on left */
/* This pref defaults to true on Mac and doesn't actually do anything on other platforms. So if your system has window controls on LEFT side you can set the pref to true */
@supports -moz-bool-pref("layout.css.osx-font-smoothing.enabled") {
  :root:is([tabsintitlebar], [sizemode="fullscreen"]) {
    --uc-window-control-width: 72px;
  }
  :root[tabsintitlebar="true"]:not([inFullscreen]) #nav-bar {
    border-inline-width: calc(
        var(--uc-window-control-width, 0px) +
          var(--uc-window-drag-space-post, 0px)
      )
      var(--uc-window-drag-space-pre, 0px);
  }
  :root[sizemode="fullscreen"]
    #TabsToolbar
    > .titlebar-buttonbox-container:last-child,
  :root[sizemode="fullscreen"] #window-controls {
    right: unset;
  }
}

/* Source file https://github.com/MrOtherGuy/firefox-csshacks/tree/master/chrome/curved_tabs.css made available under Mozilla Public License v. 2.0
See the above repository for updates as well as full license text. */

/* Makes tabs more curvy
 * Set svg.context-properties.content.enabled to true in about:config, 
 * otherwise the bottom corners will be black
 */
#tabbrowser-tabs {
  --uc-tab-curve-size: 10px; /* 10px looks about like chromium - 17px looks close to Australis tabs */
  --uc-tabs-scrollbutton-border: 0px;
  --uc-tab-line-color: rgb(10, 132, 255);
  --uc-curve-stroke-opacity: 1; /* can be used to decrease curve border contrast */
}

.tabbrowser-tab {
  padding-inline: 0px !important; /* By default, proton tabs have 2px + 2px = 4px space between them */
}
.tab-background {
  overflow: hidden !important;
  outline: none !important;
  box-shadow: none !important;
}
#TabsToolbar {
  --toolbarbutton-inner-padding: 3px !important;
}

.titlebar-spacer[type="pre-tabs"],
.tabbrowser-tab::after {
  border: none !important;
}

.tabbrowser-tab:hover > .tab-stack::before,
.tabbrowser-tab:hover > .tab-stack::after,
.tabbrowser-tab[selected] > .tab-stack::before,
.tabbrowser-tab[selected] > .tab-stack::after {
  width: var(--uc-tab-curve-size);
  height: 100%;
  display: block;
  position: absolute;
  content: "";
  fill: color-mix(in srgb, currentColor 11%, transparent);
  -moz-context-properties: fill, stroke, stroke-opacity;
  left: calc(0px - var(--uc-tab-curve-size));
  background-image: url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgc3Ryb2tlLXdpZHRoPSIxLjEiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQgbWVldCIgdmlld0JveD0iMCAwIDE3IDE2IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KICA8cGF0aCBkPSJNMCAxNyBMMCAxNiBBMTYgMTYgMCAwIDAgMTYgMCBMIDE4IDAgTCAxOCAxNyBaIiBmaWxsPSJjb250ZXh0LWZpbGwiPjwvcGF0aD4NCiAgPHBhdGggZD0iTTAgMTYgQTE2IDE2IDAgMCAwIDE2IDAiIHN0cm9rZT0iY29udGV4dC1zdHJva2UiIHN0cm9rZS1vcGFjaXR5PSJjb250ZXh0LXN0cm9rZS1vcGFjaXR5IiBmaWxsPSJ0cmFuc3BhcmVudCI+PC9wYXRoPg0KPC9zdmc+"),
    var(--lwt-header-image, none);
  background-size: var(--uc-tab-curve-size), 0;
  background-repeat: no-repeat, no-repeat;
  background-position-y: bottom, bottom -1px;
  background-position-x: -1px, auto;
  transform: scaleY(var(--uc-tab-vertical-transform));
  stroke-opacity: var(--uc-curve-stroke-opacity);
  z-index: 1;
  pointer-events: none;
  background-origin: border-box;
}
:root[lwtheme-image] .tabbrowser-tab[selected] > .tab-stack::before,
:root[lwtheme-image] .tabbrowser-tab[selected] > .tab-stack::after {
  background-attachment: scroll, fixed;
  background-size: var(--uc-tab-curve-size), auto;
  background-position-y: bottom, calc(var(--tab-min-height) - 1px);
}

.tabbrowser-tab[selected] > .tab-stack::before,
.tabbrowser-tab[selected] > .tab-stack::after {
  fill: var(--tab-selected-bgcolor, var(--toolbar-bgcolor)) !important;
  stroke: var(--lwt-tabs-border-color, transparent);
}

.tabbrowser-tab[selected] > .tab-stack:-moz-lwtheme::before,
.tabbrowser-tab[selected] > .tab-stack:-moz-lwtheme::after {
  fill: var(
    --lwt-selected-tab-background-color,
    var(--toolbar-bgcolor)
  ) !important;
}

.tabbrowser-tab:hover > .tab-stack::after,
.tabbrowser-tab[selected] > .tab-stack::after {
  left: auto;
  right: calc(0px - var(--uc-tab-curve-size));
  transform: scaleX(-1);
}

.tabbrowser-tab:hover > stack > .tab-background,
.tab-background[selected] {
  border-radius: var(--uc-tab-curve-size) var(--uc-tab-curve-size) 0 0 !important;
}

#tabbrowser-tabs:not([positionpinnedtabs]) .tabbrowser-tab:first-child,
#tabbrowser-tabs[positionpinnedtabs]
  .tabbrowser-tab[pinned]
  + .tabbrowser-tab:not([pinned]) {
  margin-inline-start: var(--uc-tab-curve-size) !important;
}

#scrollbutton-up,
#scrollbutton-down {
  border-block-width: var(--uc-tabs-scrollbutton-border, 0px) !important;
}
.tab-background[selected] {
  border: 1px solid var(--lwt-tabs-border-color) !important;
  border-bottom: none !important;
}

.tab-context-line {
  -moz-box-ordinal-group: 2;
  margin-block: 0 !important;
}

/* Annoying fix to prevent hovering of last tab to trigger tab overflow, better solution wanted */
.tabbrowser-tab[last-visible-tab] {
  margin-inline-end: var(--uc-tab-curve-size) !important;
}

/* Move tabs a bit away from the window edge, otherwise the left-most pinned tab might be partially outside of window */
#tabbrowser-tabs[positionpinnedtabs] {
  margin-left: var(--uc-tab-curve-size);
}
/* To counter the above, make tabs toolbar spacer a bit narrower so there won't be too much space reserved when window dragging spacers are shown */
.titlebar-spacer[type="pre-tabs"] {
  width: 24px !important;
}

/* OPTIONAL - COLORS - show tabs border, selected tab line and make selected tab match the main toolbar color. Also disables tab shadow */
/* Using these color options requires you to set layout.css.color-mix.enabled to true in about:config  */

#navigator-toolbox {
  --lwt-tabs-border-color: color-mix(
    in srgb,
    currentcolor,
    white 50%
  ) !important;
}
:root[lwtheme-brighttext] #navigator-toolbox {
  --lwt-tabs-border-color: color-mix(
    in srgb,
    currentcolor,
    black 50%
  ) !important;
}
#tabbrowser-tabs {
  --lwt-selected-tab-background-color: var(--toolbar-bgcolor);
}
.tab-background[selected] {
  border-top: none !important;
  --toolbar-bgcolor: transparent;
}
.tab-background:not(:-moz-lwtheme) {
  background-color: var(--lwt-selected-tab-background-color) !important;
}
.tabbrowser-tab[selected] > .tab-stack::before,
.tabbrowser-tab[selected] > .tab-stack::after {
  fill: var(
    --lwt-selected-tab-background-color,
    var(--toolbar-bgcolor)
  ) !important;
}
.tabbrowser-tab[selected] > .tab-stack::before {
  left: calc(1px - var(--uc-tab-curve-size));
}
.tabbrowser-tab[selected] > .tab-stack::after {
  right: calc(1px - var(--uc-tab-curve-size));
}
.tab-background[selected]::before {
  content: "";
  display: -moz-box;
  height: 2px;
  background: var(--uc-tab-line-color) !important;
}
#nav-bar {
  box-shadow: 0 -1px 0 var(--lwt-tabs-border-color);
}

/* OPTIONAL - Make some of the buttons in tabs toolbar rounded, which might look nicer especially with large curve size */
#tabs-newtab-button > .toolbarbutton-icon,
#TabsToolbar #new-tab-button > .toolbarbutton-icon,
#alltabs-button > .toolbarbutton-badge-stack,
.tab-close-button {
  border-radius: 30px !important;
}
