#!/bin/bash

source "$DOTFILES/functions.sh"

if [ -f ~/.cargo/env ]; then
    source ~/.cargo/env
else
    export PATH="$PATH:$HOME/.cargo/bin"
fi
if ! command -v 'cargo' &> /dev/null; then
    checkyes "Seems you don't have cargo installed. Install?"
    if [ $? -eq 0 ]; then
        wget -qO - https://sh.rustup.rs | sh
        source ~/.cargo/env
    else
        echo 'Press C-c to exit and install cargo manually.'
        read tmp
    fi
fi

while IFS= read -r line; do
    IFS='=' read -r -A cmdArr <<< "$line"
    # add one dummy in bash because zsh array is 1-index
    if [[ x`basename $SHELL` = x'bash' ]]; then
        cmdArr="tmp $cmdArr"
    fi
    cmd=${cmdArr[1]}
    alt=${cmdArr[2]}
    issudo=""
    if [[ x"$alt" == xsudo* ]]; then
        alt="${alt:5}"
        issudo="sudo "
    fi
    if [ ${#cmdArr[@]} -gt 2 ]; then
        pkg=${cmdArr[3]}
    else
        pkg="$alt"
    fi
    if ! command -v $alt &> /dev/null; then
        checkyes "$alt not installed. Do you want to install with cargo?"
        if [ $? -eq 0 ]; then
            cargo install -v $pkg
        else
            echo "failed to create alias from '$cmd' to '$alt': command not found"
            continue
        fi
    fi
    eval "alias $cmd='$issudo$alt'"
done <<- EOM
ls=exa
ps=procs
less=bat
grep=rg=ripgrep
nano=kibi
find=fd=fd-find
du=dust=du-dust
time=hyperfine
top=ytop
iftop=sudo bandwhich
hexdump=hx
objdump=bingrep
http-server=miniserve
lisence=licensor
EOM

if [ ! -d "$HOME/.npm-packages" ]; then
    mkdir "$HOME/.npm-packages"
fi
NPM_PACKAGES="${HOME}/.npm-packages"

export PATH="$PATH:$NPM_PACKAGES/bin"

# Preserve MANPATH if you already defined it somewhere in your config.
# Otherwise, fall back to `manpath` so we can inherit from `/etc/manpath`.
export MANPATH="${MANPATH-$(manpath)}:$NPM_PACKAGES/share/man"

